---
import Layout from '../../../layouts/Layout.astro';
---

<Layout title="Gestion des Événements" description="Liste des événements Anjou Explore">
  <!-- Hero Admin -->
  <section class="bg-gradient-to-r from-[var(--color-anjou-gold)] via-[var(--color-anjou-olive)] to-[var(--color-anjou-brown)] py-12 text-white">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between flex-wrap gap-4">
        <div>
          <div class="flex items-center space-x-3 mb-2">
            <a href="/admin/dashboard" class="hover:opacity-75 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
              </svg>
            </a>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <h1 class="text-2xl md:text-3xl font-serif">Gestion des Événements</h1>
          </div>
          <p class="text-white/90 text-sm">
            <span id="event-count">...</span> événements au total
          </p>
        </div>

        <button
          id="logout-btn"
          class="flex items-center space-x-2 px-5 py-2.5 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg transition border border-white/20 text-sm font-medium"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
          </svg>
          <span>Déconnexion</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="py-12 bg-gradient-to-br from-[var(--color-anjou-beige)]/20 via-white to-[var(--color-anjou-beige)]/10 min-h-[calc(100vh-300px)]">
    <div class="container mx-auto px-4 max-w-7xl">

      <!-- Header with Create Button -->
      <div class="flex justify-between items-center mb-6">
        <div></div>
        <button
          id="create-event-btn"
          class="flex items-center space-x-2 px-5 py-3 bg-gradient-to-r from-[var(--color-anjou-gold)] to-[var(--color-anjou-olive)] text-white rounded-xl hover:shadow-lg transition font-medium"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          <span>Nouvel Événement</span>
        </button>
      </div>

      <!-- Filtres -->
      <div class="bg-white rounded-2xl shadow-lg border border-[var(--color-anjou-beige)]/50 overflow-hidden mb-8">
        <div class="bg-gradient-to-r from-[var(--color-anjou-gold)] to-[var(--color-anjou-olive)] h-1.5"></div>

        <div class="p-6">
          <h2 class="text-xl font-serif text-[var(--color-anjou-brown)] mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-[var(--color-anjou-gold)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
            </svg>
            Filtres
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Filtre Statut -->
            <div>
              <label for="filter-status" class="block text-sm font-medium text-[var(--color-anjou-brown)] mb-2">
                Statut
              </label>
              <select id="filter-status" class="filter-select">
                <option value="">Tous les statuts</option>
                <option value="DRAFT">Brouillon</option>
                <option value="OPEN">Ouvert</option>
                <option value="CLOSED">Fermé</option>
                <option value="ARCHIVED">Archivé</option>
              </select>
            </div>

            <!-- Placeholder -->
            <div></div>

            <!-- Bouton Rafraîchir -->
            <div class="flex items-end">
              <button id="refresh-btn" class="refresh-button">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Rafraîchir
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tableau des événements -->
      <div class="bg-white rounded-2xl shadow-lg border border-[var(--color-anjou-beige)]/50 overflow-hidden">
        <div class="bg-gradient-to-r from-[var(--color-anjou-gold)] to-[var(--color-anjou-olive)] h-1.5"></div>

        <!-- Loading state -->
        <div id="loading-state" class="p-12 text-center">
          <div class="inline-flex items-center space-x-2 text-[var(--color-anjou-olive)]">
            <svg class="animate-spin h-6 w-6" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-sm font-medium">Chargement des événements...</span>
          </div>
        </div>

        <!-- Table container -->
        <div id="table-container" class="hidden overflow-x-auto">
          <table class="w-full">
            <thead class="bg-[var(--color-anjou-beige)]/30 border-b border-[var(--color-anjou-beige)]">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-[var(--color-anjou-brown)] uppercase tracking-wider">
                  Événement
                </th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-[var(--color-anjou-brown)] uppercase tracking-wider">
                  Date
                </th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-[var(--color-anjou-brown)] uppercase tracking-wider">
                  Statut
                </th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-[var(--color-anjou-brown)] uppercase tracking-wider">
                  Activités
                </th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-[var(--color-anjou-brown)] uppercase tracking-wider">
                  Réservations
                </th>
                <th class="px-6 py-4 text-right text-xs font-semibold text-[var(--color-anjou-brown)] uppercase tracking-wider">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody id="events-tbody" class="divide-y divide-[var(--color-anjou-beige)]/50">
              <!-- Events will be inserted here -->
            </tbody>
          </table>
        </div>

        <!-- Empty state -->
        <div id="empty-state" class="hidden p-12 text-center">
          <svg class="mx-auto h-16 w-16 text-[var(--color-anjou-olive)]/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <h3 class="text-lg font-medium text-[var(--color-anjou-brown)] mb-2">
            Aucun événement trouvé
          </h3>
          <p class="text-sm text-[var(--color-anjou-olive)] mb-6">
            Commencez par créer votre premier événement
          </p>
          <button
            id="create-event-empty-btn"
            class="inline-flex items-center space-x-2 px-5 py-2.5 bg-gradient-to-r from-[var(--color-anjou-gold)] to-[var(--color-anjou-olive)] text-white rounded-lg hover:shadow-lg transition font-medium"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            <span>Créer un événement</span>
          </button>
        </div>
      </div>

    </div>
  </section>

  <!-- Modal: Confirmation -->
  <div id="confirm-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content max-w-md">
      <div class="modal-header border-b-2 border-red-200">
        <h3 class="text-xl font-serif text-red-700 flex items-center">
          <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
          </svg>
          Confirmation
        </h3>
        <button id="confirm-modal-close" class="modal-close">✕</button>
      </div>
      <div class="modal-body p-6">
        <p id="confirm-message" class="text-[var(--color-anjou-brown)] mb-6"></p>
        <div id="confirm-details" class="hidden bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
          <p class="text-sm text-red-700 font-semibold mb-2">Cette action supprimera :</p>
          <ul id="confirm-details-list" class="text-sm text-red-600 list-disc list-inside space-y-1"></ul>
        </div>
        <div class="flex justify-end gap-3">
          <button id="confirm-cancel-btn" class="px-6 py-2.5 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium">Annuler</button>
          <button id="confirm-ok-btn" class="px-6 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium">
            Confirmer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="fixed top-4 right-4 z-[60] space-y-3"></div>
</Layout>

<style>
  /* Filter Select */
  .filter-select {
    width: 100%;
    padding: 0.625rem 1rem;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 0.75rem;
    font-size: 0.875rem;
    color: var(--color-anjou-brown);
    transition: all 0.2s;
    outline: none;
  }

  .filter-select:focus {
    border-color: var(--color-anjou-gold);
    box-shadow: 0 0 0 3px rgba(196, 165, 113, 0.1);
  }

  /* Refresh Button */
  .refresh-button {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.625rem 1rem;
    background: white;
    border: 2px solid var(--color-anjou-gold);
    color: var(--color-anjou-gold);
    border-radius: 0.75rem;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.2s;
    cursor: pointer;
  }

  .refresh-button:hover {
    background: var(--color-anjou-gold);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(196, 165, 113, 0.3);
  }

  /* Status Badges */
  .badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .badge-draft {
    background: #f3f4f6;
    color: #6b7280;
  }

  .badge-open {
    background: #d1fae5;
    color: #065f46;
  }

  .badge-closed {
    background: #fee2e2;
    color: #991b1b;
  }

  .badge-archived {
    background: #e0e7ff;
    color: #3730a3;
  }

  /* Action Buttons */
  .btn-action {
    padding: 0.5rem;
    border: none;
    background: transparent;
    cursor: pointer !important;
    border-radius: 0.5rem;
    transition: all 0.2s;
    color: var(--color-anjou-olive);
  }

  /* Ensure all buttons have pointer cursor */
  button {
    cursor: pointer !important;
  }

  /* Force cursor pointer on SVG icons inside buttons */
  .btn-action svg,
  button[data-action="view-event"],
  button[data-action="delete-event"] {
    cursor: pointer !important;
  }

  /* Prevent SVG from blocking pointer events */
  .btn-action svg {
    pointer-events: none;
  }

  .btn-action:hover {
    background: var(--color-anjou-beige)/30;
    transform: translateY(-2px);
  }

  /* Specific cursor rules for each button type */
  button.btn-action.btn-view,
  button.btn-action.btn-view:hover {
    cursor: pointer !important;
  }

  button.btn-action.btn-delete,
  button.btn-action.btn-delete:hover {
    cursor: pointer !important;
  }

  .btn-action.btn-view:hover {
    color: #3b82f6;
  }

  .btn-action.btn-delete:hover {
    color: #dc2626;
  }

  /* Table Styles */
  tbody tr {
    transition: background-color 0.2s;
  }

  tbody tr:hover {
    background: var(--color-anjou-beige)/10;
  }

  /* Animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  tbody tr {
    animation: fadeIn 0.3s ease backwards;
  }

  tbody tr:nth-child(1) { animation-delay: 0.05s; }
  tbody tr:nth-child(2) { animation-delay: 0.1s; }
  tbody tr:nth-child(3) { animation-delay: 0.15s; }
  tbody tr:nth-child(4) { animation-delay: 0.2s; }
  tbody tr:nth-child(5) { animation-delay: 0.25s; }

  /* Modal Styles */
  .modal {
    position: fixed;
    inset: 0;
    z-index: 50;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  .modal.hidden {
    display: none !important;
  }

  .modal-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    position: relative;
    background: white;
    border-radius: 1rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 32rem;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
  }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem;
  }

  .modal-close {
    padding: 0.5rem;
    border: none;
    background: transparent;
    cursor: pointer !important;
    font-size: 1.5rem;
    color: var(--color-anjou-olive);
    transition: all 0.2s;
  }

  .modal-close:hover {
    color: var(--color-anjou-brown);
    transform: scale(1.1);
  }

  .modal-body {
    padding: 1.5rem;
  }

  /* Toast Styles */
  .toast {
    min-width: 300px;
    max-width: 500px;
    padding: 1rem 1.5rem;
    border-radius: 0.75rem;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    animation: slideIn 0.3s ease;
    backdrop-filter: blur(8px);
  }

  .toast-success {
    background: linear-gradient(135deg, #d1fae5, #a7f3d0);
    border: 2px solid #059669;
    color: #065f46;
  }

  .toast-error {
    background: linear-gradient(135deg, #fee2e2, #fecaca);
    border: 2px solid #dc2626;
    color: #991b1b;
  }

  .toast-info {
    background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    border: 2px solid #2563eb;
    color: #1e40af;
  }

  .toast-icon {
    flex-shrink: 0;
    width: 1.5rem;
    height: 1.5rem;
  }

  .toast-message {
    flex: 1;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .toast-close {
    flex-shrink: 0;
    padding: 0.25rem;
    background: transparent;
    border: none;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s;
  }

  .toast-close:hover {
    opacity: 1;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(100%);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slideOut {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(100%);
    }
  }

  .toast.slide-out {
    animation: slideOut 0.3s ease forwards;
  }
</style>

<script src="../../../scripts/admin/events.ts"></script>
